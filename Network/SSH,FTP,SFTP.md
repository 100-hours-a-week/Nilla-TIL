# SSH, FTP, SFTP

### SSH(Secure Shell)란? : 보안에 취약한 텔넷을 대체하는 원격 제어 도구
- 원격 호스트에 접속하거나 명령을 실행, 정보를 전송하는 프로토콜의 일종.
- 텔넷 사용시 불가한 연결을 인증하고, 네트워크 통신을 암호화해 자료를 보호한다.
- 텔넷이란? : 호스트 컴퓨터에서 서버로 원격 접속이 가능하도록 하게 하는 인터넷 프로토콜  

### SSH의 인증 방식
- SSH의 인증에는 KEY가 사용된다. 키 생성 방식에는 대칭키와 비대칭키 방식이 있다.
    + 비대칭키 : 서버 또는 사용자가 key pair를 생성한다. 이 키는 공개 키(.pub)와 개인 키(.pem)의 두 가지로 이루어진다. 
        * ssh 최초 접속시 비대칭키를 사용한다. 사용자가 키 페어를 만들면 공개 키를 서버에게 전송하고, 서버는 공개키를 이용해 랜덤한 값을 생성한다. 이 암호는 들고 있는 개인 키로만 해석이 가능하고, 접속을 허용한다. 
        * 서버의 공개키는 ~/.ssh/authorized_keys에, 사용자가 서버에 최초 접속했을 때 등록되는 공개키는 ~/.ssh/known_hosts에 저장되어 있다. 동일한 공개 키인지 먼저 확인하여, 정상적인 서버인지 확인한다. 
        * 종종 warning: REMOTE HOST IDENTIFICATION HAS CHANGED라는 오류가 뜰 때가 있다. 이는 rsa(비대칭키 방식의 공개키를 뜻함. 여기서는 사용자가 생성해서 준 값이 아니라, 최초 접속시 서버가 제공한 공개키를 뜻한다.)값이 변경되었기 때문이다. 서버를 초기화 했다가 다시 설치하는 등의 원인으로 발생하며,서버를 신뢰할 수 있는 경우 키를 삭제하고 다시 발급받으면 된다. 
    + 대칭키 : 한개의 키만 사용하는 방식이다.
        * ssh에서 정보를 주고 받을 때 암호화/복호화를 위해 대칭키를 사용한다. 
        * 정보 교환이 완료되면 대칭 키는 폐기된다. 접속 시마다 새로운 대칭 키를 생성해 사용하게 된다. 

### FTP
- FTP(file transfer protocol)는 tcp/ip 기반의 3-handshaking을 사용하는 파일 전송용 프로토콜이다.

원래 연결 과정은

1. 클라이언트가 서버에게 ack와 본인의 데이터 채널 포트를 보내면
2. 서버는 syn-ack (ok표시)를 보내며, 클라이언트의 데이터 채널에 접속을 시도한다.
3. 그럼 클라이언트가 다시 접속 시도에 응답을 준다!

하지만 이 경우 서버가 클라이언트에 접속해야한다는 문제가 있고, 방화벽이 있다면 접속이 어려워진다.

그래서 있는 것이 **FTP passive mode**다. 이 경우

1. 클라이언트가 서버에게 패시브 모드로 연결할 것을 요청하고
2. 서버는 본인의 데이터 채널 포트를 클라이언트에게 전송한다.
3. 클라이언트의 데이터 전송 포트는 전달받은 서버의 데이터 전송 포트로 접속을 시도한다.
4. 서버가 클라이언트의 접속 시도에 응답을 준다.
이렇게하면 단점을 해소할 수 있다.

### SFTP
- 외부 네트워크 파일 전송 프로토콜인 FTP는 암호화를 하지 않는다. 
- SSH를 이용해 사용자 인증을 처리하고, 자료를 암호화해서 보내는 방식이 SFTP다.
- 독립적이지 않으며, SSH 프로토콜의 하위 시스템으로 동작한다. SSH 서버가 클라이언트의 요청을 받고, 하위 시스템인 sftp-server에게 처리를 명령하는 식으로 동작. 

#### 참고자료
- [SSH(Secure Shell)의 원리와 사용방법 알아보기](https://velog.io/@realsy/SSHSecure-Shell%EC%9D%98-%EC%9B%90%EB%A6%AC%EC%99%80-%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0)
- [SSH 명칭부터 접속까지 한 번에 이해하기](https://library.gabia.com/contents/infrahosting/9002/)
- [[ssh] host의 rsa키값이 변경되어서 접속이 불가할 때](https://kkyunstory.tistory.com/89)
- [FTP Active Passive Mode 정리](https://wildeveloperetrain.tistory.com/195)